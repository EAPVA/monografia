\chapter{Implementação do HOG}

Foi decidido realizar a implementação do HOG como uma biblioteca, de maneira a 
facilitar a utilização em projetos futuros. Foram inclusas na biblioteca uma
implementação em GPU e outra em CPU, com uma interface comum.

No restante deste capítulo primeiramente serão apresentadas as ferramentas de
\emph{software} e \emph{hardware} utilizadas, seguido da apresentação da
organização da biblioteca. Após isso, uma documentação breve de cada um
dos módulos e finalmente uma descrição detalhada da implementação em GPU.

\section{Ferramentas utilizadas}

\subsection{Kit de desenvolvimento Jetson TK1}

A placa embarcada Jetson TK1, produzida pela NVidia, foi escolhida para o
projeto devido ao seu poder de processamento, baixo consumo e custo de \$192,
valor relativamente baixo se comparado com as alternativas disponíveis no
mercado.

A placa utiliza o \sigla{SoC}{System on Chip}(\emph{System on Chip}) Tegra K1,
um processador de 4 cores ARM Cortex A15 e possui uma GPU integrada com a
arquitetura Kepler contendo 192 cores Cuda separados fisicamente em três blocos.
Cada bloco tem sua própria cache que é compartilhada entre seus 64 cores e pode
ser utilizada para sincronizar as threads em execução. A placa possui uma
memória RAM de 2GB com largura de 64-bits, sendo ela compartilhada com entre a
CPU e a GPU, não sendo necessário copiar os dados entre as partes, diferente de
uma GPU discreta que possui sua própria memória dedicada separada da CPU. A
memória é grande o suficiente para nos permitir trabalhar com imagem e vídeo.

Juntamente com a placa, foi utilizado o ambiente de desenvolvimento da NVidia,
maisespecificadamente, uma versão modificada do Eclipse que nos permite
codificar qualquer tipo de aplicação para a placa e para GPUs.

\subsection{OpenCV}

OpenCV\footnote{http://opencv.org} é uma biblioteca de código-aberto para aplicações 
  de processamento de
imagem. A biblioteca é disponibilizada gratuitamente e recebe suporte por parte
de sua comunidade. Ela possui um módulo com algumas funcionalidades
implementadas para aplicações em GPU e
a NVidia disponibiliza uma versão compilada com otimizações especifícas para o 
processador Tegra K1, como parte do \emph{framework} CUDA.

Foi utilizada a versão 2.4.9 da biblioteca para desenvolvimento e a versão
otimizada da NVidia para execução na placa.

\subsection{TinyXML-2}

Para realizar a permanência de configuração do sistema, foi utilizada a
biblioteca TinyXML-2\footnote{http://grinninglizard.com/tinyxml2}, inclusa como
dois arquivos-fonte no projeto.

\subsection{Boost}

Alguns detalhes de implementação foram supridos pelo uso de algumas bibliotecas
do conjunto de bibliotecas Boost\footnote{http://boost.org}. Mais
especificamente, foram usadas as bibliotecas \emph{thread}, \emph{chrono},
  \emph{random} e \emph{filesystem} para, respectivamente, fazer chamadas
  assíncronas de função, medir o tempo de execução de trechos de código,
  geração eficiente de números aleatórios e automatização de acesso aos
  arquivos do sistema para realização dos testes.

\subsection{GitHub}

Foi utilizada a plataforma GitHub para realizar o versionamento de código do
projeto. A biblioteca pode ser encontrada em: 
<https://github.com/EAPVA/GHoGLib>, o código usado para testes em
<https://github.com/EAPVA/GHoGLib\_Tests> e um código de exemplo utilizando a
biblioteca em <https://github.com/EAPVA/GHoGLib\_Example>.

\section{Organização da biblioteca}

A biblioteca possui as seguintes classes e interfaces:

\begin{itemize}
  \item \textbf{HogDescriptor} - Implementação na CPU do HOG.
  \item \textbf{HogGPU} - Implementação na GPU do HOG, é uma subclasse de
  HogDescriptor.
  \item \textbf{Settings} - Funcionalidade de permanência de parâmetros de
  configuração.
  \item \textbf{Utils} - Classe estática com métodos utilitários.
  \item \textbf{IClassifier} - Interface para implementar um classificador.
  Para ser utilizada em trabalhos futuros.
\end{itemize}

Além disso, a biblioteca possui dois \emph{headers} especiais:

\begin{itemize}
  \item \textbf{HogCallbacks.inc} - Possui métodos de \emph{callback}
  para serem usados
  nos métodos assíncronos.
  \item \textbf{GHoGLibConstants.inc} - Contém constantes usadas no sistema.
\end{itemize}

A implementação da classe HogGPU está dividida em quatro arquivos:

\begin{itemize}
  \item \textbf{HogGPU.h} - Possui a definição da classe
  \item \textbf{HogGPU.cu} - Possui a implementação da parte \emph{host} da
  classe.
  \item \textbf{HogGPU\_impl.cuh} - Define as funções \emph{kernel} usadas na
  classe.
  \item \textbf{HogGPU\_imph.cu} - Implementa as funções \emph{kernel} usadas.
\end{itemize}

\subsection{Hog Callbacks}

Algumas classes de \emph{callback} são definidas para serem utilizadas em
métodos assíncronos:

\begin{itemize}
  \item \textbf{ImageCallback} - Retorna uma image processada.
  \item \textbf{GradientCallback} - Retorna duas matrizes, uma com as
  magnitudes dos gradientes e outra com as orientações.
  \item \textbf{DescriptorCallback} - Retorna um vetor conténdo o descritor
  de características.
  \item \textbf{ClassifyCallback} - Retorna o resultado de uma classificação
  (se a região de uma imagem pertence ou não a uma classe.) Para ser usado em
  trabalhos futuros.
  \item \textbf{LocateCallback} - Retorna uma lista de retângulos de objetos
  indentificados em uma imagem. Para ser usado em trabalhos futuros.
\end{itemize}

\subsection{Constantes}

\subsubsection{GHOG\_LIB\_STATUS}

Define os códigos de erro usados na biblioteca.

\begin{itemize}
  \item \textbf{GHOG\_LIB\_STATUS\_OK} - Nenhum erro ocorreu.
  \item \textbf{GHOG\_LIB\_STATUS\_UNKNOWN\_ERROR} - Um erro desconhecido ocorreu.
\end{itemize}

\subsection{HogDescriptor}

A classe HogDescriptor possui uma interface com os seguintes métodos públicos:

\subsection{Settings}

\subsection{Utils}

\subsection{IClassifier}


